<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投資シミュレータ - 銀行・貯蓄型保険・NISA比較ツール（無料）</title>
    <meta name="description" content="毎月の積立額と投資期間を入力するだけで、銀行預金・貯蓄型保険・NISAの資産推移を比較できる無料シミュレーター。すべての計算はブラウザ内で完結します。">
    
    <!-- OGP Meta Tags -->
    <meta property="og:title" content="投資シミュレータ - 銀行・貯蓄型保険・NISA比較ツール（無料）">
    <meta property="og:description" content="毎月の積立額と投資期間を入力するだけで、銀行預金・貯蓄型保険・NISAの資産推移を比較。無料でお使いいただけるシミュレーターです。">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="投資シミュレータ">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Google Analytics GA4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXX');
    </script>
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "投資シミュレータ",
        "description": "毎月の積立額と投資期間を入力するだけで、銀行預金・貯蓄型保険・NISAの資産推移を比較できる無料シミュレーター。すべての計算はブラウザ内で完結します。",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web Browser",
        "price": "0",
        "priceCurrency": "JPY",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "JPY"
        },
        "featureList": [
            "銀行預金シミュレーション",
            "貯蓄型保険シミュレーション", 
            "NISAシミュレーション",
            "投資期間カスタマイズ",
            "リアルタイム計算",
            "グラフ表示",
            "完全ブラウザ内処理"
        ],
        "browserRequirements": "JavaScript有効なブラウザ",
        "softwareVersion": "1.0",
        "author": {
            "@type": "Person",
            "name": "投資シミュレータ開発者"
        }
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f7f5;
            background-image: 
                linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(255,255,255,0.4) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.4) 75%),
                linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.4) 75%);
            background-size: 30px 30px;
            background-position: 0 0, 0 15px, 15px -15px, -15px 0px;
            color: #4a4a4a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
            line-height: 1.6;
        }

        .header {
            text-align: center;
            margin: 40px 0 50px 0;
        }

        h1 {
            font-size: 2.8em;
            font-weight: 500;
            color: #5d5852;
            margin-bottom: 15px;
            font-family: 'Noto Sans JP', sans-serif;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.1em;
            color: #7a736b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 400;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 24px;
            padding: 50px 40px;
            border: 1px solid rgba(220, 218, 215, 0.3);
            box-shadow: 0 8px 32px rgba(160, 155, 145, 0.08);
        }

        .input-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 40px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .input-row {
            display: flex;
            gap: 20px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }

        .input-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }

        .input-item .input-field {
            width: 100%;
        }

        .calculate-btn {
            background: #8b8074;
            color: white;
            border: 1px solid transparent;
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(139, 128, 116, 0.15);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Noto Sans JP', sans-serif;
            width: 100%;
            max-width: 300px;
        }

        .calculate-btn:hover {
            background: #7a6f63;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(139, 128, 116, 0.25);
        }

        .calculate-btn:disabled {
            background: #d4cfc7;
            color: #9b9388;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .input-label {
            font-size: 1.3em;
            font-weight: 600;
            color: #5d5852;
            text-align: center;
        }

        .input-field {
            width: 100%;
            padding: 18px 24px;
            font-size: 1.4em;
            border: 2px solid #d4cfc7;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.8);
            color: #4a4a4a;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Noto Sans JP', sans-serif;
        }

        .input-field:focus {
            outline: none;
            border-color: #8b8074;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(139, 128, 116, 0.15);
            transform: translateY(-1px);
        }

        .results {
            width: 100%;
            display: none;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e8e3de;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #e8e3de;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(160, 155, 145, 0.1);
        }

        .card-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #5d5852;
            margin-bottom: 10px;
        }

        .card-amount {
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .card-detail {
            font-size: 0.9em;
            color: #7a736b;
        }

        .bank-card .card-amount { color: #dc3545; }
        .insurance-card .card-amount { color: #fd7e14; }
        .nisa-card .card-amount { color: #198754; }

        .calculating {
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .calculating-message {
            text-align: center;
            color: #7a736b;
            font-size: 0.9em;
            margin-top: 10px;
            font-style: italic;
        }

        @media (max-width: 600px) {
            body {
                padding: 20px 15px;
            }
            
            .header {
                margin: 30px 0 40px 0;
            }

            h1 {
                font-size: 2.2em;
            }
            
            .main-area {
                padding: 35px 25px;
            }

            .chart-container {
                height: 300px;
                padding: 15px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .input-field {
                font-size: 1.2em;
                padding: 16px 20px;
            }

            .input-row {
                flex-direction: column;
                gap: 15px;
            }

            .input-item {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>投資シミュレータ</h1>
        <div class="subtitle">
            <span>銀行 • 貯蓄型保険 • NISA</span>
        </div>
    </div>

    <div class="main-area">
        <div class="input-container">
            <div class="input-group">
                <div class="input-row">
                    <div class="input-item">
                        <label class="input-label" for="monthlyAmount">毎月の積立額（円）</label>
                        <input type="number" id="monthlyAmount" class="input-field" placeholder="例: 30000" min="1" max="1000000" step="1" aria-label="毎月の積立額を円単位で入力">
                    </div>
                    <div class="input-item">
                        <label class="input-label" for="yearsAmount">投資期間（年）</label>
                        <input type="number" id="yearsAmount" class="input-field" placeholder="例: 30" min="1" max="100" step="1" aria-label="投資期間を年単位で入力">
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateBtn" disabled aria-label="投資シミュレーションを実行">
                    シミュレーション実行
                </button>
            </div>
        </div>

        <div class="results" id="results">
            <div class="chart-container">
                <canvas id="investmentChart" role="img" aria-label="投資シミュレーション結果のグラフ"></canvas>
            </div>
            
            <div class="summary-cards">
                <div class="summary-card bank-card">
                    <div class="card-title">銀行預金（利率0%）</div>
                    <div class="card-amount" id="bankAmount">¥0</div>
                    <div class="card-detail">元本のみ</div>
                </div>
                
                <div class="summary-card insurance-card">
                    <div class="card-title">貯蓄型保険（利率1%）</div>
                    <div class="card-amount" id="insuranceAmount">¥0</div>
                    <div class="card-detail">年1回複利</div>
                </div>
                
                <div class="summary-card nisa-card">
                    <div class="card-title">NISA（利率7%）</div>
                    <div class="card-amount" id="nisaAmount">¥0</div>
                    <div class="card-detail">年1回複利</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chart = null;
        const monthlyInput = document.getElementById('monthlyAmount');
        const yearsInput = document.getElementById('yearsAmount');
        const calculateBtn = document.getElementById('calculateBtn');
        const results = document.getElementById('results');
        const bankAmountEl = document.getElementById('bankAmount');
        const insuranceAmountEl = document.getElementById('insuranceAmount');
        const nisaAmountEl = document.getElementById('nisaAmount');

        function calculateInvestments(monthlyAmount, years) {
            // キャッシュキーを生成
            const cacheKey = `${monthlyAmount}-${years}`;
            
            // キャッシュから結果を取得
            if (calculationCache.has(cacheKey)) {
                return calculationCache.get(cacheKey);
            }

            const bankData = [];
            const insuranceData = [];
            const nisaData = [];
            const labels = [];

            // 最適化: 年間積立額を事前計算
            const annualAmount = monthlyAmount * 12;

            // 最適化: 複利計算を効率化
            let insuranceTotal = 0;
            let nisaTotal = 0;

            for (let year = 1; year <= years; year++) {
                labels.push(`${year}年`);
                
                // 銀行預金（利率0%）
                const bankTotal = annualAmount * year;
                bankData.push(bankTotal);
                
                // 貯蓄型保険（年1%複利）
                if (year === 1) {
                    insuranceTotal = annualAmount;
                } else {
                    insuranceTotal = insuranceTotal * 1.01 + annualAmount;
                }
                insuranceData.push(Math.round(insuranceTotal));
                
                // NISA（年7%複利）
                if (year === 1) {
                    nisaTotal = annualAmount;
                } else {
                    nisaTotal = nisaTotal * 1.07 + annualAmount;
                }
                nisaData.push(Math.round(nisaTotal));
            }

            const result = {
                labels,
                bankData,
                insuranceData,
                nisaData,
                finalBank: bankData[bankData.length - 1],
                finalInsurance: insuranceData[insuranceData.length - 1],
                finalNisa: nisaData[nisaData.length - 1]
            };

            // 結果をキャッシュに保存
            calculationCache.set(cacheKey, result);
            
            // キャッシュサイズ制限（最新20件のみ保持）
            if (calculationCache.size > 20) {
                const firstKey = calculationCache.keys().next().value;
                calculationCache.delete(firstKey);
            }

            return result;
        }

        function formatCurrency(amount) {
            return '¥' + amount.toLocaleString('ja-JP');
        }

        function updateChart(monthlyAmount, years) {
            // 大きな数値の場合は計算中表示
            const isLargeCalculation = monthlyAmount >= 500000 || years >= 80;
            
            if (isLargeCalculation) {
                showCalculatingStatus(true);
            }

            // 非同期で計算を実行（大きな数値の場合UIをブロックしない）
            if (isLargeCalculation) {
                setTimeout(() => {
                    const data = calculateInvestments(monthlyAmount, years);
                    updateUI(data);
                    showCalculatingStatus(false);
                }, 10);
            } else {
                const data = calculateInvestments(monthlyAmount, years);
                updateUI(data);
            }
        }

        function updateUI(data) {
            // サマリーカードの更新
            bankAmountEl.textContent = formatCurrency(data.finalBank);
            insuranceAmountEl.textContent = formatCurrency(data.finalInsurance);
            nisaAmountEl.textContent = formatCurrency(data.finalNisa);

            const ctx = document.getElementById('investmentChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: '銀行預金',
                            data: data.bankData,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: '貯蓄型保険',
                            data: data.insuranceData,
                            borderColor: '#fd7e14',
                            backgroundColor: 'rgba(253, 126, 20, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: 'NISA',
                            data: data.nisaData,
                            borderColor: '#198754',
                            backgroundColor: 'rgba(25, 135, 84, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Noto Sans JP',
                                    size: 14
                                },
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#4a4a4a',
                            bodyColor: '#4a4a4a',
                            borderColor: '#d4cfc7',
                            borderWidth: 1,
                            cornerRadius: 8,
                            titleFont: {
                                family: 'Noto Sans JP',
                                size: 14
                            },
                            bodyFont: {
                                family: 'Noto Sans JP',
                                size: 13
                            },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: '年数',
                                font: {
                                    family: 'Noto Sans JP',
                                    size: 14
                                }
                            },
                            ticks: {
                                font: {
                                    family: 'Noto Sans JP'
                                },
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: '資産額（円）',
                                font: {
                                    family: 'Noto Sans JP',
                                    size: 14
                                }
                            },
                            ticks: {
                                font: {
                                    family: 'Noto Sans JP'
                                },
                                callback: function(value) {
                                    return (value / 10000).toFixed(0) + '万円';
                                }
                            }
                        }
                    }
                }
            });

            results.style.display = 'block';
        }

        function showCalculatingStatus(show) {
            const resultsElement = document.getElementById('results');
            const existingMessage = document.querySelector('.calculating-message');
            
            if (show) {
                resultsElement.classList.add('calculating');
                if (!existingMessage) {
                    const message = document.createElement('div');
                    message.className = 'calculating-message';
                    message.textContent = '計算中...';
                    resultsElement.appendChild(message);
                }
            } else {
                resultsElement.classList.remove('calculating');
                if (existingMessage) {
                    existingMessage.remove();
                }
            }
        }

        let hasShownResults = false;
        let debounceTimeout = null;
        let calculationCache = new Map();

        // 両方の入力値をチェックする関数
        function checkInputs() {
            const amount = parseInt(monthlyInput.value);
            const years = parseInt(yearsInput.value);
            return amount && amount >= 1 && years && years >= 1;
        }

        // デバウンス処理
        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // 入力値の変更でボタンの有効/無効を制御、または結果表示済みならリアルタイム更新
        function handleInputChange() {
            const amount = parseInt(monthlyInput.value);
            const years = parseInt(yearsInput.value);
            
            if (checkInputs()) {
                calculateBtn.disabled = false;
                // 一度結果を表示したらリアルタイム更新（デバウンス処理）
                if (hasShownResults) {
                    debouncedUpdate(amount, years);
                }
            } else {
                calculateBtn.disabled = true;
                // 入力値が無効になったら結果を非表示
                if (hasShownResults) {
                    results.style.display = 'none';
                }
            }
        }

        // デバウンス処理を適用した更新関数
        const debouncedUpdate = debounce((amount, years) => {
            updateChart(amount, years);
        }, 500);

        monthlyInput.addEventListener('input', handleInputChange);
        yearsInput.addEventListener('input', handleInputChange);

        // ボタンクリックでシミュレーション実行
        calculateBtn.addEventListener('click', function() {
            const amount = parseInt(monthlyInput.value);
            const years = parseInt(yearsInput.value);
            if (checkInputs()) {
                hasShownResults = true;
                updateChart(amount, years);
                // ボタンを非表示にする
                calculateBtn.style.display = 'none';
            }
        });

        // Enterキーでもシミュレーション実行
        function handleEnterKey(e) {
            if (e.key === 'Enter') {
                const amount = parseInt(monthlyInput.value);
                const years = parseInt(yearsInput.value);
                if (checkInputs() && !calculateBtn.disabled) {
                    hasShownResults = true;
                    updateChart(amount, years);
                    // ボタンを非表示にする
                    calculateBtn.style.display = 'none';
                }
            }
        }

        monthlyInput.addEventListener('keypress', handleEnterKey);
        yearsInput.addEventListener('keypress', handleEnterKey);

        // 初期表示はシンプルに（結果非表示）
        monthlyInput.value = '';
        yearsInput.value = '';

        document.addEventListener('DOMContentLoaded', function() {
            console.log('投資シミュレータ準備完了');
        });
    </script>

    <footer style="margin-top: 120px; font-size: 13px; color: #9c948b; text-align: center; max-width: 650px; width: 100%; margin-left: auto; margin-right: auto; line-height: 1.6;">
        投資シミュレータは、銀行預金・貯蓄型保険・NISAの<br>
        資産推移を比較できる無料ツールです。<br>
        すべての計算はブラウザ内で完結し、データが外部に送信されることはありません。
    </footer>
</body>
</html>